---
layout: post
title: ActiveMQ持久化
category: program
tags: [jms,activemq]
---

#简介
消息持久性对于可靠消息传递来说应该是一种比较好的方法，有了消息持久化，即使发送者和接受者不是同时在线或者消息中心在发送者发送消息后宕机了，在消息中心重新启动后仍然可以将消息发送出去，如果把这种持久化和ReliableMessaging结合起来应该是很好的保证了消息的可靠传送。

消息持久性的原理很简单，就是在发送者将消息发送出去后，消息中心首先将消息存储到本地数据文件、内存数据库或者远程数据库等，然后试图将消息发送给接收者，发送成功则将消息从存储中删除，失败则继续尝试。消息中心启动以后首先要检查制定的存储位置，如果有未发送成功的消息，则需要把消息发送出去。

ActiveMQ持久化的形式：AMQ、KahaDB、JDBC、LevelDB。ActiveMQ5.9.1版本默认配置是KahaDB，对于三种持久化配置，稍后具体详解。
#AMQ
AMQ是一种文件存储形式，它具有写入速度快和容易恢复的特点。消息存储在一个个文件中，文件的默认大小为32M，如果一条消息的大小超过了32M，那么这个值必须设置大一点。当一个存储文件中的消息已经全部被消费，那么这个文件将被标识为可删除，在下一个清除阶段，这个文件被删除。**AMQ适用于ActiveMQ5.3之前的版本**。
#KahaDB
KahaDB是基于文件的本地数据库储存形式，虽然没有AMQ的速度快，但是它具有强扩展性，恢复的时间比AMQ短，**从5.4版本之后KahaDB做为默认的持久化方式**。
#JDBC
可以将消息存储到数据库中，例如：Mysql、SQL Server、Oracle、DB2。
#LevelDB
这种文件系统是从ActiveMQ5.8之后引进的，它和KahaDB非常相似，也是基于文件的本地数据库储存形式，但是它提供比KahaDB更快的持久性。与KahaDB不同的是，它不是使用传统的B-树来实现对日志数据的提前写，而是使用基于索引的LevelDB。
#写在后面的话
这里只有ActiveMQ持久化的简介，以后会在每种持久化的方式进行详细的补充。